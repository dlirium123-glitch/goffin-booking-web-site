<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin — Goffin Booking</title>

  <!-- ✅ évite l’indexation -->
  <meta name="robots" content="noindex,nofollow" />

  <link rel="stylesheet" href="/admin.css?v=2026-02-16-3" />

  <!-- Firebase (Compat) -->
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script defer src="/__/firebase/init.js"></script>
</head>

<body>
<noscript>
  <div style="padding:12px; font-weight:900;">
    JavaScript est requis pour accéder à l’admin.
  </div>
</noscript>

<header>
  <div class="topbar">
    <div class="brand">
      <h1>Admin — Goffin Booking</h1>
      <p>Gestion des rendez-vous & planning</p>
      <p class="tiny versionLine">
        Version : <span id="adminVersion">—</span>
      </p>
    </div>

    <div class="status">
      <span class="pill" id="pillStatus">
        <span class="dot"></span>
        <span id="statusText">Non connecté</span>
      </span>
      <button class="btnTop" id="btnLogin" type="button">Connexion</button>
      <button class="btnTop secondary" id="btnLogout" type="button" hidden>Déconnexion</button>
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- LEFT -->
    <section class="card">
      <h2>Rendez-vous</h2>

      <div class="row">
        <div>
          <div class="tiny fieldTitle">Filtre statut</div>
          <select id="statusFilter">
            <option value="pending">En attente</option>
            <option value="validated">Validés</option>
            <option value="refused">Refusés</option>
            <option value="cancelled">Annulés</option>
            <option value="all">Tous</option>
          </select>
        </div>

        <div>
          <div class="tiny fieldTitle">Recherche (note / email)</div>
          <input id="search" placeholder="Ex: chaudière, adresse, @..." />
        </div>

        <div class="rowEnd">
          <button class="btn primary" id="btnRefresh" type="button">Rafraîchir</button>
        </div>
      </div>

      <!-- ✅ bannière état sync Outlook (lit syncHealth/outlook) -->
      <div id="syncHealthBanner" class="warn" style="display:none" hidden></div>

      <div id="apptMsg" class="alert"></div>
      <div id="apptOk" class="ok"></div>

      <div id="apptList" class="list"></div>
      <div id="apptEmpty" class="muted emptyState" hidden>Aucun rendez-vous</div>

      <div class="hr"></div>

      <h2>Planning public (freeSlots)</h2>
      <p class="muted">
        Génère les créneaux visibles côté client (lun→ven, 09:30→17:30, blocs 90 min) sur 8 semaines.
      </p>
      <div class="row">
        <button class="btn primary" id="btnGenFreeSlots" type="button">Générer 8 semaines</button>
        <button class="btn" id="btnGenPreview" type="button">Prévisualiser (console)</button>
      </div>
      <div id="slotsMsg" class="alert"></div>
      <div id="slotsOk" class="ok"></div>

      <div class="hr"></div>

      <h2>Outlook Sync</h2>
      <p class="muted">
        La synchronisation tourne automatiquement via GitHub Actions (cron).
        <br />
        Si besoin, tu peux la relancer manuellement (Run workflow).
      </p>

      <div class="row">
        <a
          class="btn primary"
          id="btnOpenOutlookWorkflow"
          href="https://github.com/dlirium123-glitch/goffin-booking-web-site/actions/workflows/outlook-sync.yml"
          target="_blank"
          rel="noopener noreferrer"
        >
          Ouvrir “Outlook sync” (Run workflow)
        </a>

        <a
          class="btn"
          id="btnOpenActionsAll"
          href="https://github.com/dlirium123-glitch/goffin-booking-web-site/actions"
          target="_blank"
          rel="noopener noreferrer"
        >
          Tous les workflows
        </a>
      </div>

      <div class="warn" style="display:block; margin-top:10px;">
        ✅ GitHub → bouton <b>Run workflow</b> → relancer si la sync automatique ne passe pas.
      </div>
    </section>

    <!-- RIGHT -->
    <section class="card">
      <h2>Planning (vue semaine)</h2>
      <p class="muted">Lecture seule — reflète l’état des créneaux (free/pending/blocked).</p>

      <div id="planningGrid"></div>

      <div class="hr"></div>

      <h2>Demandes de modification</h2>
      <p class="muted">Par défaut : status = "new"</p>

      <div class="row">
        <div>
          <div class="tiny fieldTitle">Filtre</div>
          <select id="modifFilter">
            <option value="new">Nouvelles</option>
            <option value="all">Toutes</option>
          </select>
        </div>
        <div class="rowEnd">
          <button class="btn primary" id="btnRefreshModifs" type="button">Rafraîchir</button>
        </div>
      </div>

      <div id="modifMsg" class="alert"></div>
      <div id="modifOk" class="ok"></div>

      <div id="modifList" class="list"></div>
      <div id="modifEmpty" class="muted emptyState" hidden>Aucune demande</div>
    </section>

  </div>
</main>

<!-- Modal login -->
<div class="overlay" id="overlay">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <h2 id="loginTitle" class="modalTitle">Connexion admin</h2>

    <div class="tiny fieldTitle">Adresse e-mail</div>
    <input id="loginEmail" type="email" placeholder="Email" autocomplete="email" />

    <div class="tiny fieldTitle">Mot de passe</div>
    <input id="loginPass" type="password" placeholder="Mot de passe" autocomplete="current-password" />

    <div class="row modalActions">
      <button class="btn primary" id="doLogin" type="button">Se connecter</button>
      <button class="btn" id="closeLogin" type="button">Annuler</button>
    </div>

    <div id="loginErr" class="alert" hidden></div>
  </div>
</div>

<script defer src="/admin.v3.js?v=admin-2026-02-16-3"></script>
</body>
</html>
